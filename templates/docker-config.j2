# Docker Configuration Template

## Purpose
Generate production-ready Docker configurations for applications.

## Template Variables
- {{app_name}}: Application name
- {{language}}: Programming language
- {{version}}: Language version
- {{port}}: Application port
- {{dependencies}}: External services (db, cache, etc.)
- {{build_command}}: Command to build the application
- {{run_command}}: Command to start the application
- {{env_vars}}: Environment variables to configure

## Generated Output

\`\`\`dockerfile
# {{app_name}} - Docker Configuration
# Generated by Awesome-Grok-Workflows

# ========================================
# Base Image
# ========================================
FROM {{language}}:{{version}}-alpine

# Labels for container metadata
LABEL maintainer="team@example.com" \
      version="1.0.0" \
      description="{{app_name}} production container"

# ========================================
# Build Arguments
# ========================================
ARG APP_USER=appuser
ARG APP_GROUP=appgroup

# ========================================
# Environment Configuration
# ========================================
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    NODE_ENV=production \
    APP_PORT={{port}}

# ========================================
# Security: Create Non-Root User
# ========================================
RUN addgroup -g 1000 ${APP_GROUP} && \
    adduser -u 1000 -G ${APP_GROUP} -s /bin/sh -D ${APP_USER}

# ========================================
# System Dependencies
# ========================================
RUN apk add --no-cache \
    curl \
    && rm -rf /var/cache/apk/*

# ========================================
# Application Installation
# ========================================
WORKDIR /app

# Copy dependency manifests first (for caching)
{% if language == 'python' %}
COPY requirements* ./
RUN pip install --no-cache-dir -r requirements.txt
{% elif language == 'node' %}
COPY package* ./
RUN npm ci --only=production
{% endif %}

# Copy application code
COPY . .

# Build artifacts (if needed)
RUN {{build_command}}

# ========================================
# Directory Permissions
# ========================================
RUN chown -R ${APP_USER}:${APP_GROUP} /app

# Switch to non-root user
USER ${APP_USER}

# ========================================
# Health Check
# ========================================
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:${APP_PORT}/health || exit 1

# ========================================
# Expose Port
# ========================================
EXPOSE ${APP_PORT}

# ========================================
# Start Command
# ========================================
CMD ["{{run_command}}"]
\`\`\`

## Docker Compose Template

\`\`\`yaml
version: '3.8'

services:
  {{app_name}}:
    build:
      context: .
      dockerfile: Dockerfile
    image: {{app_name}}:${TAG:-latest}
    container_name: {{app_name}}
    ports:
      - "{{port}}:{{port}}"
    environment:
      - NODE_ENV=production
      - APP_PORT={{port}}
{% for env_var in env_vars %}
      - {{env_var}}
{% endfor %}
{% for dep in dependencies %}
    {{dep.name}}:
      condition: service_healthy
{% endfor %}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:{{port}}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M

{% for dep in dependencies %}
  {{dep.name}}:
    image: {{dep.image}}
    environment:
{% for env in dep.envs %}
      - {{env}}
{% endfor %}
    healthcheck:
      test: ["CMD", "{{dep.health_check}}"]
      interval: 10s
      timeout: 5s
      retries: 5
{% endfor %}

networks:
  default:
    name: {{app_name}}-network
\`\`\`

## Usage

\`\`\`bash
# Build the image
docker build -t {{app_name}}:latest .

# Run with compose
docker-compose up -d

# View logs
docker-compose logs -f {{app_name}}
\`\`\`
